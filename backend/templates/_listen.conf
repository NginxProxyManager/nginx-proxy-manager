
{% if proxy_protocol_enabled == 1 or proxy_protocol_enabled == true -%}
{% assign port_number_http = "88" -%}
{% assign port_number_https = "444" -%}
{% assign listen_extra_args = "proxy_protocol" -%}
{% else -%}
{% assign port_number_http = "80" -%}
{% assign port_number_https = "443" -%}
{% assign listen_extra_args = "" -%}
{% endif -%}

  listen {{ port_number_http }} {{ listen_extra_args }};
{% if ipv6 -%}
  listen [::]:{{ port_number_http }} {{ listen_extra_args }};
{% else -%}
  #listen [::]:{{ port_number_http }} {{ listen_extra_args }};
{% endif -%}

{% if certificate -%}
{% capture listen_extra_args_https %}ssl {{ listen_extra_args }}{% endcapture -%}
  listen {{ port_number_https }} {{ listen_extra_args_https }};
{% if ipv6 -%}
  listen [::]:{{ port_number_https }} {{ listen_extra_args_https }};
{% else -%}
  #listen [::]:{{ port_number_https }} {{ listen_extra_args_https }};
{% endif -%}
{% endif -%}

  server_name {{ domain_names | join: " " }};
{% if http2_support == 1 or http2_support == true %}
  http2 on;
{% else -%}
  http2 off;
{% endif %}
